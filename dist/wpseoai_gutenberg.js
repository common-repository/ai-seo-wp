(()=>{"use strict";var e={354:(e,s,t)=>{var o=t(196),i=Symbol.for("react.element"),n=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,r=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,s,t){var o,n={},d=null,c=null;for(o in void 0!==t&&(d=""+t),void 0!==s.key&&(d=""+s.key),void 0!==s.ref&&(c=s.ref),s)a.call(s,o)&&!l.hasOwnProperty(o)&&(n[o]=s[o]);if(e&&e.defaultProps)for(o in s=e.defaultProps)void 0===n[o]&&(n[o]=s[o]);return{$$typeof:i,type:e,key:d,ref:c,props:n,_owner:r.current}}s.Fragment=n,s.jsx=d,s.jsxs=d},527:(e,s,t)=>{e.exports=t(354)},357:function(e,s,t){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0});const i=t(527),n=t(817),a=t(67),r=t(609),l=t(196),d=t(818),c=t(736),u=t(981),p=o(t(989)),h=({isOpen:e,setIsOpen:s})=>{var t;let o;const[n,u]=(0,l.useState)({stale:!1,locales:null,defaultLocale:null,summary:null,submissionState:0,auditId:0,postId:0,revisionId:0,showRetrieve:!1}),h=e=>u((s=>Object.assign(Object.assign({},s),e))),w=()=>{var e;return null!==(e=n.submissionState)&&void 0!==e?e:0},f=e=>{"AbortError"===e.name&&console.log("Request has been aborted"),console.error(null==e?void 0:e.message),alert(null==e?void 0:e.message)},m=e=>{clearInterval(o),h(Object.assign(Object.assign({},e),{submissionState:0}))},v=()=>{console.log("Attempting submission retrieval");const e="undefined"==typeof AbortController?void 0:new AbortController;(0,p.default)({path:`/wpseoai/v1/retrieve?post=${n.postId}`,signal:null==e?void 0:e.signal}).then((e=>{const s=e;console.log(s),h({stale:200===s.code,submissionState:200===s.code?0:2,showRetrieve:200!==s.code})})).catch((e=>{f(e),h({submissionState:0})}))},b=e=>{e.preventDefault();const s=e.currentTarget.getAttribute("data-locale");if(!s)return;h({submissionState:1});const t="undefined"==typeof AbortController?void 0:new AbortController;(0,p.default)({path:`/wpseoai/v1/optimize?locale=${s}&post=${n.postId}`,signal:null==t?void 0:t.signal}).then((e=>{let s={};const t=e;(null==t?void 0:t.auditId)&&(s.auditId=t.auditId),s.submissionState=2,h(s),console.log("Submission sent")})).catch((e=>{f(e),h({submissionState:0})}))};(0,l.useEffect)((()=>{if(!n.showRetrieve&&2===n.submissionState){const e=15e3,s=2500;let t=Date.now(),i=0,a=0;o=setInterval((()=>{let o=e-a*s;o<s&&(o=s);let r=t+o;const l=Date.now();if(l>=r){if(!n.auditId)return console.log("Invalid audit ID, unable to track progress of submission"),m();const e="undefined"==typeof AbortController?void 0:new AbortController;(0,p.default)({path:`/wpseoai/v1/audit?post=${n.auditId}&limit=1`,signal:null==e?void 0:e.signal}).then((e=>{"1"===(null==e?void 0:e.state)&&(m({stale:!0}),console.log("Response received"))})).catch((e=>{f(e),m()})),t=l,a++}i++,i>12&&(m(),console.log("Post-back not received; interval cleared"),v())}),s)}}),[n.submissionState]),(0,l.useEffect)((()=>{const e=(0,d.select)("core/editor").getCurrentPostId();h({postId:e});const s=(0,d.select)("core/editor").getCurrentPostLastRevisionId();h({revisionId:s});const t="undefined"==typeof AbortController?void 0:new AbortController;(0,p.default)({path:`/wpseoai/v1/context?post=${e}`,signal:null==t?void 0:t.signal}).then((e=>{let s={};const t=e;t.hasOwnProperty("defaultLocale")&&(s.defaultLocale=t.defaultLocale),t.hasOwnProperty("locales")&&(s.locales=t.locales),t.hasOwnProperty("summary")&&(s.summary=t.summary),h(s)})).catch((e=>{f(e)}))}),[]);const g=n.stale?"green":2===n.submissionState||1===n.submissionState?"blue":"grey";return(0,i.jsxs)(a.PluginSidebar,{name:"wpseoai-sidebar",title:"WPSEO.AI (Beta)",icon:"share-alt",children:[(0,i.jsxs)(r.PanelBody,{title:(0,c.__)("Help","ai-seo-wp"),initialOpen:!1,children:[(0,i.jsx)("p",{children:(0,c.__)("The WPSEO.AI service is currently in beta phase. More features are in development.","ai-seo-wp")}),(0,i.jsx)("p",{children:(0,c.__)("Please note, using the buttons and features on this sidebar, will deduct small chunks of credits, based on the content provided, from your subscription balance.","ai-seo-wp")}),(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:(0,i.jsx)("a",{href:`/wp-admin/revision.php?revision=${n.revisionId}&gutenberg=true`,children:"View revisions"})}),(0,i.jsx)("li",{children:(0,i.jsx)("a",{href:"/wp-admin/admin.php?page=wpseoai_dashboard",children:"View audit logs"})}),(0,i.jsx)("li",{children:(0,i.jsx)("a",{href:"https://wpseo.ai/faq.html",target:"_blank",children:"Frequently asked questions"})})]})]}),(0,i.jsx)(r.PanelBody,{title:"Summary of changes",className:n.summary?"":"hidden",children:(0,i.jsx)("p",{children:null!==(t=n.summary)&&void 0!==t?t:(0,i.jsx)("i",{children:"N/A"})})}),(0,i.jsx)(r.PanelBody,{title:"Status",children:(0,i.jsxs)("p",{className:`wpseoai-status ${g}`,children:[(0,i.jsx)("div",{"aria-hidden":"true"}),(0,i.jsx)("span",{children:n.stale?(0,i.jsx)("a",{href:"",children:(0,c.__)("Reload page","ai-seo-wp")}):2===n.submissionState?(0,i.jsx)("i",{children:(0,c.__)("Processing","ai-seo-wp")}):1===n.submissionState?(0,i.jsx)("i",{children:(0,c.__)("Sending","ai-seo-wp")}):(0,i.jsx)("i",{children:(0,c.__)("Inactive","ai-seo-wp")})})]})}),(0,i.jsxs)(r.PanelBody,{title:(0,c.__)("Tools","ai-seo-wp"),children:[(0,i.jsx)("p",{children:(0,i.jsx)(r.Button,{"data-locale":n.defaultLocale,variant:"primary",onClick:b,isBusy:w()>0,"aria-disabled":w()>0,disabled:w()>0,children:(0,c.__)("Finesse (All)","ai-seo-wp")})}),(0,i.jsx)("p",{children:(0,i.jsx)(r.Button,{variant:"secondary",className:n.showRetrieve?"":"hidden",onClick:()=>v(),"aria-disabled":0===w(),disabled:0===w(),children:(0,c.__)("Retrieve","ai-seo-wp")})})]}),n.locales?(0,i.jsxs)(r.PanelBody,{title:(0,c.__)("Translate (WPML)","ai-seo-wp"),children:[(0,i.jsx)("p",{children:"Choose the language to translate this content into. Activate more languages, for more options below."}),(0,i.jsx)("p",{children:n.locales&&Object.entries(n.locales).map((([e,s])=>{if(s.code!==n.defaultLocale)return(0,i.jsx)(r.Button,{className:"wpseoai-translate","data-locale":e,variant:"secondary",onClick:b,isBusy:w()>0,"aria-disabled":w()>0,children:s.display_name})}))})]}):null]})};(0,n.registerPlugin)("custom-sidebar",{render:()=>{const[e,s]=(0,l.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h,{isOpen:e,setIsOpen:s}),(0,i.jsx)(a.PluginSidebarMoreMenuItem,{target:"wpseoai-sidebar",children:"WPSEO.AI (Beta)"})]})}}),(0,u.registerBlockCollection)("wpseoai",{title:(0,c.__)("WPSEO.AI (Beta)","ai-seo-wp")})},196:e=>{e.exports=window.React},989:e=>{e.exports=window.wp.apiFetch},981:e=>{e.exports=window.wp.blocks},609:e=>{e.exports=window.wp.components},818:e=>{e.exports=window.wp.data},67:e=>{e.exports=window.wp.editPost},736:e=>{e.exports=window.wp.i18n},817:e=>{e.exports=window.wp.plugins}},s={},t=function t(o){var i=s[o];if(void 0!==i)return i.exports;var n=s[o]={exports:{}};return e[o].call(n.exports,n,n.exports,t),n.exports}(357),o=window;for(var i in t)o[i]=t[i];t.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();
//# sourceMappingURL=wpseoai_gutenberg.js.map